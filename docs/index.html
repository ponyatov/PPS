<title>PPS/js</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="black">
<link rel="icon" type="image/png" href="planning.png" />

<link rel="stylesheet" href="shared.css">

<div id=swipe>
<pre id=log># log

 <img src="android_plan.png"/> Welcome

 This PPS/js system is a 
 JavaScript/HTML implementation of a
 <a href="https://ponyatov.quora.com/On-computer-language-design-PPS-Personal-Planning-System-platform">Personal Planning System</a> prototype
 extended with <a href="https://ponyatov.quora.com/On-computer-language-design-metaprogramming-1">metaprogramming</a> features. 

 To understand the overall idea
 first look this <a href="http://www.google.com/url?q=http%3A%2F%2Fwww.bayfronttechnologies.com%2Fmc_workshop.html&sa=D&sntz=1&usg=AFQjCNF-KH1P-tQqIjhb2C0f7Fl1jCivKg">METAII workshop</a>:
 it is an online implementation of a
 METAII metacompiler (by) D.V. Schorre
 
 Here I implemented tiny draft with a
 feel of METAII workshop described above.
 But it uses <a href="http://pegjs.org">PEG.js parser generator</a>
 works in your browser as a js library,
 so you have full control over syntax
 and semantics right in your hands.
 
 <h1>How to use it</h1>
 
 If you scroll this page now to right,
 you'll see the cyan-colored window
 with PEG grammar of some FORTH-like
 script mixed with JavaScript code
 will be executed on every rule match
   
</pre>

<pre id=stack># stack</pre>
<pre id=words># words</pre>

<textarea id=meta oninput='swipe_upd()'>// PEG grammar

ber
  = pfx:'0x' hex:[0-9a-fA-F]+
    { return 'hex:'+pfx+join(hex) }
  / pfx:'0b' bin:[01]+
    { return 'bin:'+pfx+join(bin) }
  / num:([0-9]+[.][0-9]*)
    { return 'num:'+join(num) }
  / exp:([0-9]+[eE][+\-]?[0-9]+)
    { return 'exp:'+join(exp) }
  / int:[0-9]+
    { return 'int:'+join(int) }
    
name
  = token:[a-zA-Z0-9_]+
    { return join(token) }
  / op:[()+*]
    { return 'op:'+op }

comment
  = '#'[^\n]* { return "" }

_ "whitespace"
  = [ \t\n\r]*

</textarea>

</div>

<div id=cmd>

<textarea id=pad rows=5># console
22 * (3 + 4)
1 2.3 4e-5 0xDeadBeef 0b1101
</textarea>

<button id=go onclick="gocmd()">GO</button>
</div>


<script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-auth.js"></script>
<!--script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-database.js"></script-->
<!--script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-firestore.js"></script-->
<!--script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-messaging.js"></script-->
<!--script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-functions.js"></script-->
<script>
  // Initialize Firebase
  var firebase_config = {
    apiKey: "AIzaSyAmUfAweE5EM6L-mpMFmo8jOJp1yb7zKWE",
    authDomain: "leafy-oxide-211212.firebaseapp.com",
    databaseURL: "https://leafy-oxide-211212.firebaseio.com",
    projectId: "leafy-oxide-211212",
    storageBucket: "leafy-oxide-211212.appspot.com",
    messagingSenderId: "475478214606"
  };
  firebase.initializeApp(firebase_config);
</script>

<script src="PEG.js"></script>
<script>

function gocmd() { INTERPRET(pad.value) }

function clr()  { log.innerText = '' }
function out(str) { log.innerText += str+'\n' }
function join(dat) { return dat.join("") }

function errlog(e) {
	S = 'error:\n'
	JSON.stringify(e).match(/.{1,40}/g).forEach(function(item,i,arr) {
		S += item + '\n'
	})
	return S 
}

function INTERPRET(SRC) {
	clr();
	sessionStorage[Date()] = SRC
	try { peg.generate(meta.value).parse(pad.value)	}
	catch(e) { log.innerText += errlog(e) }
	
}

function Sym(T,V) {
	this.type  = T
	this.value = V
	this.attr  = {}
	this.nest  = []
}

function Stack(name) { return Sym('stack',name); }

Sym.prototype.push = function(object) { this.nest.push(object) }

Sym.prototype.dump = Sym.prototype.head = function() { return "<"+this.type+":"+this.value+">" }

function Voc(name)   { return Sym('voc',name);   }

var S = new Stack('data') 

var W = Voc('global')

function swipe_upd() {
	//meta.style.width  = meta.scrollWidth +1 + "px"
	meta.style.height = meta.scrollHeight + "px"
}

function update() {
	stack.innerText = S.dump()
	words.innerText = W.dump()
	swipe_upd()
}

function keydown(event) {
	if (event.ctrlKey & event.key == 'Enter') gocmd()
}

window.onload = function() {
	document.body.onkeydown = keydown
	if (navigator.onLine) online(); else offline(); // fix on reload
	update();
}

function offline() { go.style.borderColor = "darkred" }
window.onoffline = offline

function  online() { go.style.borderColor = "green"   }
window.ononline  = online

</script>
