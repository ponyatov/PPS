<title>META/js</title>

<style>

* {
	background: black; color: lightgreen;
	font-family: monospace, monospace; font-size: 2vh;
	border: solid; margin: 0; 
}

textarea,button { width:100%; }

textarea { caret-color: red; }

#cmd { position: absolute; bottom: 0; width:100%; }

#stack,#pad { color: cyan; min-height:1em; }

#go { background: darkslategrey; height: 11vmin; }

</style>

<pre id=log># log</pre>

<pre id=stack># stack</pre>

<div id=cmd>
<textarea id=meta rows=11>// PEG grammar

SRC " source code "
  = (( comment / symbol ) _ ) *

comment = [\#\\][^\n]*

_ " drop spaces " = [ \t\r\n]*

symbol = token:[a-zA-Z0-9_\+\-.]+
  { push(join(token)) }

</textarea>

<textarea id=pad rows=5># command

-1 +02.30 +4e-5 0xDeadBeef 0b1101 \ numbers


</textarea>

<button id=go onclick="go()">GO</button>

</div>

<script src="PEG.js"></script>
<script>

function join(token) { return token.join('') }

function sf(some) {
	S = ''
	JSON.stringify(some).match(/.{1,40}/g).forEach(function(item,i,arr) {
		S += item + '\n'
	})
	return S	
}

function out(some) { log.innerText += JSON.stringify(some)+'\n' }

S = []

function push(obj) { S.push(obj) }

function error(e) { return 'error:\n' + sf(e) }

function go() {
	log.innerText = ''
	try {
		var parser = peg.generate(meta.value)
		parser.parse(pad.value)
	} catch(e) { log.innerText = error(e) }
	stack.innerText = sf(S)
}

function keydown(event) {
	if (event.ctrlKey & event.key == 'Enter') go()
}

window.onload = function() {
	document.body.onkeydown = keydown
}
</script>